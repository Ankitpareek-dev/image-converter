<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Simple Image Compressor</title>
    <style>
      body {
        font-family: system-ui, sans-serif;
        max-width: 400px;
        margin: 40px auto;
        padding: 16px;
      }
      .card {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 16px;
      }
      label {
        display: block;
        margin-top: 12px;
        margin-bottom: 4px;
        font-size: 14px;
      }
      input {
        width: 100%;
      }
      button {
        margin-top: 16px;
        padding: 10px 18px;
        border-radius: 6px;
        background: black;
        color: white;
        font-weight: 600;
        border: none;
        cursor: pointer;
      }
      #status {
        margin-top: 10px;
        font-size: 13px;
        color: #555;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <h2>Image Size Reducer</h2>

      <form id="compressForm">
        <label>Select image</label>
        <input type="file" id="image" accept="image/*" required />

        <label>Target size (KB)</label>
        <input type="number" id="targetKb" min="1" required />

        <button type="submit">Compress</button>
      </form>

      <p id="status"></p>
    </div>

    <script>
      const form = document.getElementById("compressForm");
      const statusEl = document.getElementById("status");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const file = document.getElementById("image").files[0];
        const kb = document.getElementById("targetKb").value;

        if (!file) return (statusEl.textContent = "Please choose an image.");

        const formData = new FormData();
        formData.append("image", file);
        formData.append("targetKb", kb);

        statusEl.textContent = "Compressing...";

        try {
          const res = await fetch("/api/compress", {
            method: "POST",
            body: formData,
          });

          if (!res.ok) {
            statusEl.textContent = "Error: " + (await res.text());
            return;
          }

          const blob = await res.blob();

          statusEl.textContent =
            "Done! Output: " +
            Math.round(blob.size / 1024) +
            " KB (download starting...)";

          const a = document.createElement("a");
          a.href = URL.createObjectURL(blob);
          a.download = "compressed.jpg";
          a.click();
        } catch (err) {
          statusEl.textContent = "Unexpected error.";
        }
      });
    </script>
  </body>
</html>
